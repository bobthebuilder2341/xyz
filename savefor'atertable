import { render, screen, fireEvent, act } from '@testing-library/react';
import FileTableView from './FileTableView'; // Path to your component
import '@testing-library/jest-dom';
import { TablePaginationActionsProps } from './TablePaginationActions'; // Path to TablePaginationActions if needed

const mockSetCurrentPage = jest.fn();
const mockSetCheckedFiles = jest.fn();
const mockSetIsAllFilesChecked = jest.fn();
const mockCheckedHandleToggle = jest.fn();
const mockOnClickFileFunctionality = jest.fn();
const mockFileList = [
  { fileName: 'file1.txt', filePath: 'path/to/file1.txt', fileType: 'file' },
  { fileName: 'folder1/', filePath: 'path/to/folder1/', fileType: 'folder' },
];
const mockProps = {
  optionVisibility: {},
  modalVisibility: {},
  fileList: mockFileList,
  onClickFileFunctionality: mockOnClickFileFunctionality,
  checkedFiles: [],
  checkedHandleToggle: mockCheckedHandleToggle,
  parentDirectorySetter: jest.fn(),
  fetchAndUpdateFileList: jest.fn(),
  setCheckedFiles: mockSetCheckedFiles,
  currentPage: 0,
  setCurrentPage: mockSetCurrentPage,
  isAllFilesChecked: false,
  setIsAllFilesChecked: mockSetIsAllFilesChecked,
};

describe('FileTableView Component', () => {
  it('should render file list correctly', () => {
    render(<FileTableView {...mockProps} />);
    expect(screen.getByText('file1.txt')).toBeInTheDocument();
    expect(screen.getByText('folder1/')).toBeInTheDocument();
  });

  it('should toggle select all checkbox correctly', () => {
    render(<FileTableView {...mockProps} />);

    // Check that the checkbox is not checked initially
    expect(screen.getByTestId('fileTableViewCheckbox')).not.toBeChecked();

    // Simulate checking the "select all" checkbox
    fireEvent.click(screen.getByTestId('fileTableViewCheckbox'));

    // Check that the checkbox is now checked
    expect(mockSetCheckedFiles).toHaveBeenCalled();
    expect(mockSetIsAllFilesChecked).toHaveBeenCalledWith(true);
  });

  it('should handle page changes correctly when using pagination', () => {
    render(<FileTableView {...mockProps} />);
    
    // Mock for the pagination buttons
    const nextPageButton = screen.getByLabelText('next page');
    fireEvent.click(nextPageButton);
    
    // Check if setCurrentPage was called with the correct value
    expect(mockSetCurrentPage).toHaveBeenCalledWith(1);
  });

  it('should handle rows per page change correctly', () => {
    render(<FileTableView {...mockProps} />);
    
    // Change the rows per page
    fireEvent.change(screen.getByLabelText('Files per page'), { target: { value: 10 } });
    
    // Check if the rows per page value has been updated
    expect(screen.getByLabelText('Files per page').value).toBe('10');
  });

  it('should render the download status indicator correctly', () => {
    render(<FileTableView {...mockProps} />);

    // Check if the download indicator is displayed for files in the download list
    const rotatingIcon = screen.queryByTestId('rotating-icon');
    expect(rotatingIcon).toBeNull(); // Assuming it's not in the list
  });
  
  it('should call the file click handler when a file is clicked', () => {
    render(<FileTableView {...mockProps} />);

    const fileButton = screen.getByText('file1.txt');
    fireEvent.click(fileButton);

    expect(mockOnClickFileFunctionality).toHaveBeenCalledWith(mockFileList[0]);
  });

  it('should disable pagination buttons when necessary', () => {
    render(<FileTableView {...mockProps} />);
    
    // Assuming the page is 0, the "First" and "Previous" buttons should be disabled
    const firstPageButton = screen.getByLabelText('first page');
    const previousPageButton = screen.getByLabelText('previous page');
    expect(firstPageButton).toBeDisabled();
    expect(previousPageButton).toBeDisabled();
  });

  it('should render folder icon for folder files', () => {
    render(<FileTableView {...mockProps} />);

    const folderIcon = screen.getByTestId('folder-icon');
    expect(folderIcon).toBeInTheDocument();
  });
});
